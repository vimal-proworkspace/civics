<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Municipal Official Dashboard</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 20px;
  }
  h2 {
    text-align: center;
    color: #1976d2;
    margin-bottom: 30px;
  }
  .filter-bar {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
  }
  .filter-bar select {
    padding: 8px 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    min-width: 150px;
    font-size: 14px;
  }
  #complaintsList {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  .complaint-card {
    background: white;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: 0.2s;
    border-left: 5px solid #1976d2;
  }
  .complaint-card:hover {
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    transform: translateY(-2px);
  }
  .complaint-details {
    margin-top: 10px;
    padding: 10px;
    background: #f4f6f8;
    border-radius: 8px;
  }
  .status-badge {
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
    color: white;
    display: inline-block;
  }
  .status-pending { background: #ff9800; }
  .status-inprogress { background: #1976d2; }
  .status-resolved { background: #4caf50; }
  .priority-high { color: red; font-weight: bold; }
  .priority-normal { color: #555; }
  .sla-breach {
    border-left: 5px solid red !important;
  }
  button.status-btn {
    margin-right: 5px;
    padding: 6px 12px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 13px;
    transition: 0.2s;
  }
  button.inprogress { background: #1976d2; color: white; }
  button.resolved { background: #4caf50; color: white; }
  button.pending { background: #ff9800; color: white; }
  button.status-btn:hover { opacity: 0.85; }
  .notification-bell {
    position: fixed;
    top: 15px;
    right: 20px;
    cursor: pointer;
    font-size: 28px;
  }
  .notification-badge {
    position: absolute;
    top: -5px;
    right: -10px;
    background: red;
    color: white;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 12px;
  }
  .notification-dropdown {
    display: none;
    position: fixed;
    top: 50px;
    right: 20px;
    background: white;
    border: 1px solid #ccc;
    width: 320px;
    max-height: 400px;
    overflow-y: auto;
    z-index: 100;
    border-radius: 8px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
  }
  .notification-item {
    padding: 10px;
    border-bottom: 1px solid #eee;
    font-size: 14px;
  }
  .notification-item:last-child { border-bottom: none; }
  img.complaint-photo { max-width: 200px; border-radius: 8px; margin-top: 8px; }
</style>
</head>
<body>
<h2>Municipal Official Dashboard</h2>

<div class="notification-bell" id="notificationBell">
  ðŸ””<span class="notification-badge" id="notificationCount">0</span>
</div>
<div class="notification-dropdown" id="notificationDropdown"></div>

<div class="filter-bar">
  <select id="filterCategory">
    <option value="">All Categories</option>
    <option value="Road & Pavement Issues">Road & Pavement Issues</option>
    <option value="Street Lighting Problems">Street Lighting Problems</option>
    <option value="Waste & Garbage Management">Waste & Garbage Management</option>
    <option value="Water Supply & Sewage">Water Supply & Sewage</option>
    <option value="Traffic Signals & Signage">Traffic Signals & Signage</option>
    <option value="Public Safety & Security">Public Safety & Security</option>
    <option value="Parks & Public Spaces">Parks & Public Spaces</option>
    <option value="Health & Sanitation">Health & Sanitation</option>
    <option value="Other / Miscellaneous">Other / Miscellaneous</option>
  </select>

  <select id="filterPriority">
    <option value="">All Priorities</option>
    <option value="High">High</option>
    <option value="Normal">Normal</option>
  </select>

  <select id="filterStatus">
    <option value="">All Statuses</option>
    <option value="Pending Review">Pending Review</option>
    <option value="In Progress">In Progress</option>
    <option value="Resolved">Resolved</option>
  </select>
</div>

<div id="complaintsList"></div>

<script>
const notifications=[];
const filterCategory = document.getElementById('filterCategory');
const filterPriority = document.getElementById('filterPriority');
const filterStatus = document.getElementById('filterStatus');
const complaintsContainer = document.getElementById('complaintsList');

function getComplaints(){ return JSON.parse(localStorage.getItem('complaints')||'[]'); }

function renderComplaints(){
  let list = getComplaints();
  if(filterCategory.value) list = list.filter(c => c.category === filterCategory.value);
  if(filterPriority.value) list = list.filter(c => c.priority === filterPriority.value);
  if(filterStatus.value) list = list.filter(c => c.status === filterStatus.value);

  complaintsContainer.innerHTML = '';
  notifications.length = 0;

  list.forEach(c=>{
    const div = document.createElement('div');
    const created = new Date(c.createdAt);
    const now = new Date();
    const slaBreach = ((now - created)/(1000*60*60)) > 72;

    div.className = 'complaint-card' + (slaBreach ? ' sla-breach' : '');
    
    // Status badge
    let statusClass = '';
    if(c.status === 'Pending Review') statusClass='status-pending';
    else if(c.status === 'In Progress') statusClass='status-inprogress';
    else if(c.status === 'Resolved') statusClass='status-resolved';

    div.innerHTML = `
      <div><strong>${c.title}</strong> 
      <span class="status-badge ${statusClass}">${c.status}</span></div>
      <p>${c.desc}</p>
      <p>Category: ${c.category}, Priority: <span class="priority-${c.priority==='High'?'high':'normal'}">${c.priority}</span></p>
      <p>Location: ${c.latitude.toFixed(4)}, ${c.longitude.toFixed(4)}</p>
      <div>
        <button class="status-btn pending" onclick="updateStatus(${c.id},'Pending Review',event)">Pending Review</button>
        <button class="status-btn inprogress" onclick="updateStatus(${c.id},'In Progress',event)">In Progress</button>
        <button class="status-btn resolved" onclick="updateStatus(${c.id},'Resolved',event)">Resolved</button>
      </div>
      <div class="complaint-details" style="display:none;" id="details-${c.id}">
        ${c.photo?`<img class="complaint-photo" src="${c.photo}"/>`:''}
      </div>
    `;

    div.addEventListener('click',()=>{ 
      const d = document.getElementById('details-'+c.id);
      d.style.display = d.style.display==='none'?'block':'none';
    });

    complaintsContainer.appendChild(div);

    if(slaBreach) notifications.push(`SLA breach for complaint "${c.title}"`);
  });

  document.getElementById('notificationCount').textContent = notifications.length;
  renderNotifications();
}

function updateStatus(id, status, event){
  event.stopPropagation(); // Prevent card toggle
  const complaints = getComplaints();
  const cIndex = complaints.findIndex(c => c.id === id);
  if(cIndex>-1){
    complaints[cIndex].status = status;
    localStorage.setItem('complaints', JSON.stringify(complaints));
    renderComplaints();
  }
}

filterCategory.addEventListener('change', renderComplaints);
filterPriority.addEventListener('change', renderComplaints);
filterStatus.addEventListener('change', renderComplaints);

const bell = document.getElementById('notificationBell');
const dropdown = document.getElementById('notificationDropdown');
bell.addEventListener('click', ()=>{ dropdown.style.display = dropdown.style.display==='block'?'none':'block'; });

function renderNotifications(){
  dropdown.innerHTML = '';
  if(notifications.length===0){ dropdown.innerHTML = '<p style="padding:10px;">No notifications</p>'; return; }
  notifications.forEach(msg=>{
    const d = document.createElement('div');
    d.className='notification-item';
    d.textContent = msg;
    dropdown.appendChild(d);
  });
}

renderComplaints();
</script>
</body>
</html>
